#!/bin/sh

volume_up() {
	amixer set Master 1%+
}

volume_down() {
	amixer set Master 1%-
}

light_up() {
	brightnessctl set +1%
}

light_down() {
	brightnessctl set 1%-
}

screenshot() {
	grim ~/screenshots/$(date +%s).png
}

proxy() {
	while read line; do
		case $line in
			*tags*)
				tags=" "
				select=$(echo $line | cut -d ' ' -f 4)
				for tag in 1 2 3 4 5 6 7 8 9; do
					mask=$((1 << $((tag - 1))))
					if ((select & mask)) 2> /dev/null; then
						tags+="[${tag}]"
					else
						tags+=" ${tag} "
					fi
				done
				;;
			*title*)
				title=$(echo $line | cut -d ' ' -f 3)
				;;
			*layout*)
				layout=$(echo $line | cut -d ' ' -f 3)
				echo "${tags}  ${layout}  ${title}"
				;;
		esac
	done < /dev/stdin
}

init() {
	proxy | ergo -F "Fira Code 16" -b 3f3f3f -f efefef &
	while true;
	do
		echo "  $(iwctl station wlan0 show | awk '/network/{ print $3  }') \
  $(free --mega | awk 'NR==2 { printf "%s/%s", $3, $2 }') \
  $(brightnessctl -m | awk -F"," '{ print $4 }') \
  $(amixer get Master | awk -F"[][]" '/Mono:/{ print $2 }') \
  $(cat /sys/class/power_supply/BAT0/capacity)% \
 $(date '+%a, %b %d, %R') "
		sleep 5
	done | ergo -b 3f3f3f -f efefef -F "Fira Code 16" -B -r &
	swaybg -i ~/wallpapers/wallpaper.svg &
}

menu() {
	cmd=$(echo -e "   chromium\n   telegram\n   music \n   discord \n   wallpapers \n   poweroff\n   reboot" |
	ring -f "Fira Code 16" -N 3f3f3f -S 7f7f7f -n efefef -s efefef)
	case $cmd in
		*telegram*)
			telegram-desktop &
			;;
		*chromium*)
			chromium &
			;;
		*wallpapers*)
			wallpaper=$(for i in $(ls ~/wallpapers); do echo " $i "; done | ring -f "Fira Code 16" -N 3f3f3f -S 7f7f7f -n efefef -s efefef)
			pkill swaybg
			swaybg -i ~/wallpapers/$(echo ${wallpaper} | xargs)
			;;
		*poweroff*)
			poweroff
			;;
		*reboot*)
			reboot
			;;
	esac
}

$1
